name = "enque-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Production environment
[env.production]
name = "enque-api-production"
routes = [
  { pattern = "api.enque.cc", custom_domain = true }
]

# Workers configuration
workers_dev = false
route = ""

# Bindings
[[env.production.d1_databases]]
binding = "enque_db"
database_name = "enque-db"
database_id = "ca370dea-c6be-4865-8201-094b59c24dc7" # Add your D1 database ID here

[[env.production.r2_buckets]]
binding = "enque_storage"
bucket_name = "enque-storage"

[[env.production.kv_namespaces]]
binding = "enque_cache"
id = "1853412f085744bb8fd3d3e15585b7e8" # Add your KV namespace ID here

[[env.production.durable_objects.bindings]]
name = "REALTIME"
class_name = "RealtimeHandler"
script_name = "enque-api-production"

# Durable Object migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = ["RealtimeHandler"]

# Cron triggers for email sync
[env.production.triggers.crons]
crons = ["*/3 * * * *"]  # Every 3 minutes

# Secrets (set via: wrangler secret put SECRET_NAME)
# - JWT_SECRET
# - MICROSOFT_CLIENT_ID
# - MICROSOFT_CLIENT_SECRET
# - MICROSOFT_TENANT_ID
# - DATABASE_ENCRYPTION_KEY

# Environment variables
[env.production.vars]
ENVIRONMENT = "production"
FRONTEND_URL = "https://app.enque.cc"
API_BASE_URL = "https://api.enque.cc"
MICROSOFT_REDIRECT_URI = "https://api.enque.cc/v1/auth/microsoft/callback"
MICROSOFT_GRAPH_URL = "https://graph.microsoft.com/v1.0"
MICROSOFT_SCOPE = "offline_access Mail.Read Mail.ReadWrite Mail.Send User.Read"
EMAIL_SYNC_ENABLED = true
EMAIL_SYNC_BATCH_SIZE = 10
ENABLE_RATE_LIMITING = true
LOG_LEVEL = "info"
